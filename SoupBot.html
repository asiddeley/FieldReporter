<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title id='browserTab' >aisBot</title>


<!-- bootstrap v4 -->
<!--
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css" 
	integrity="sha384-/Y6pD6FV/Vv2HJnA6t+vslU6fwYXjCFtcEpHbNJ0lyAFsXTsjBbfaDjzALeQsN6M" crossorigin="anonymous">
<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js" integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/js/bootstrap.min.js" integrity="sha384-h0AbiXch4ZDo7tp9hKZ4TsHbi047NrKGLO3SEJAg45jXxnGIfYzk4Si90RDIqNm1" crossorigin="anonymous"></script>
-->

<script type='text/javascript' src="jquery/jquery.js"></script>
<script type='text/javascript' src="jquery/jquery-ui.js"></script>
<link rel="stylesheet" type="text/css" href="jquery/jquery-ui.theme.css">
<link rel="stylesheet" type="text/css" href="jquery/jquery-ui.structure.css">
<link rel="stylesheet" type="text/css" href="jquery/jquery-ui.css">



<!-- soup Library -->
<script type='text/javascript' src="./soup/dist/soup.js"></script>
<!--script type='text/javascript' data-main="soup/soup" src="require/require.js"></script-->

<!-- Handlebars Template engine -->
<!--script type='text/javascript' src="handlebars/handlebars-v4.0.10.js"></script-->

<!--script type='text/javascript' src="./handlebars/handlebars.min-latest.js" ></script-->
<!--script src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.10/handlebars.min.js"></script-->
<!--script type = "text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.5/handlebars.js"></script-->


<!--link rel="stylesheet" href="./soup/turnDialogStyle.css" -->

<style rel="stylesheet">
.row-bot {background:CORNSILK;}
.row-user {background:LAVENDER;}
</style>

<script type="text/javascript">

//prevent accidental image drop
$(window).on({
	"drop": function(e){ e=e||event; e.preventDefault(); false;},
	"dragover":function(e){ e=e||event; e.preventDefault(); false;}
});

//inhibit the browser's right-click context menu
$(document).on("contextmenu", false);

//load script
//var script=document.createElement("script");
//script.type="text/javascript";
//script.src="./soup/private/dbAPI.js";    
//var dbAPI=document.head.appendChild(script);



function WordMatcher(options){
	if (this===window) {return new WordPattern(options)};

	this.createResult=function(options){
		//returns a new result object with all default field:vlaues and allows specified fields to be overidden via options object
		//Object.create({});
		options=(typeof options == "undefined")?{}:options;
		return $.extend({},{
			matched:false,
			patternStr:"",
			range:"",
			score:0,
		}, options);	
	};
	
	this.def=function(left, right){
		//eg. ("[noun]", "[person]|[place]|[thing]")
		//resolve definitions here, not at match time! 
		//if definition is a function, make sure it returns T/F within 6 recurrsions then store it.
		//if definition is a string and a function seed, prepare the function and store.
		//that should cover all cases.
		var that=this;
		if (typeof left != "string") {
			console.log("syntax error - wordDef requires text/string arguments"); 
			return null;
		}
		else if (typeof right == "function") { 
			this.fn[left]=right;
			console.log(this.fn[left]);
		}
		else if ((typeof right == "string")&&(right.search("|")!=-1)){
			//definition contains an operator	
			//create function that compares range word to right words (rw)
			var rightWords=right.split("|");
			this.fn[left]=function(word, index, range){
				//loops through matches until true (matched), otherwise returns false
				console.log("inside wordDef function created from:", matches);
				return rightWords.some(function(rw){return (word==rw);});
			}
			console.log(this.fn[left]);
		} 
		else if (typeof right == "string"){	
			//definition right value is just a string so
			//create simple function that compares it to the word provided from range 
			this.fn[left]=function(word, index, range){return(word==right);};
			console.log(this.fn[left]);
		};		
			
	};
	
	//this.definitions=[];
	
	//function storage - Ie. resolved definitions
	//functions stored here will be called thus: function(word, index, range){...} 
	//and be expected to return a result object based on this.resultDefault({match:true...})
	this.fn={};  
	
	//this.fn["fnNotFound"]=function(word){
		//filter to handle a common error
		//return this.resultDefault({exit:true, msg:"error, ["+word+"] not defined"});
	//};
	
	//name of "..." actually works!
	//this.fn["elipsis"]=function(word){
		//filter similar to * that matches any word
		//return this.defaultResult({match:true, word:word});
	//};
	
	////////////////////////////////////////	
	this.match=function(rangeStr){
		//var match=this.match;
		var that=this;
		var range=rangeStr.split(" ");
		//itterate through patterns until match found
		var r=this.patterns.some(function(p, i){
			return that.matchSome(p, range, 0);
		});
		return this.createResult({matched:r});		
	};
	
	this.matchSome=function(pattern, range, level){
		/********************
		.some tests the parts of the pattern against the range, continue if matched, exit at first mismatch. Note that some() exits when callback returns true (so need to negate match result).  
		.map on the other hand, tests all parts whether match is true or false.
		pattern=[d,w,  f,w,  f]  
		range  =[w,w,w,w,w,w,w,w,w,w,w,w]
		result =[1,1,1,1,0]
		where d=function derived in define, f=function directly defined & w=function derived from word
		*****************/
		level=(typeof level=="undefined")?0:level++;
		var that=this;
		//var that=this;
		var move=0; //mover offset, so that 'star' or '...' funtion can move the pattern along the range
		
		//start off true, anding 1 false will negate all. 
		//all functions of a pattern must be true (and) so exit after first false 
		var matched=true; 	
		
		var r=pattern.some(function(fname, i, a){
			//f, i, a - pattern match function, index, array ie. pattern
			console.log("inside matchSome, pattern fn:", fname);
			var r;
			if (move+i < range.length){
				var f=that.fn[fname];
				if (typeof f == "function"){ r=f(range[move+i], i, a);}
				//matched=matched && r.matched; //calculate overall result 	
			} 
			else { r=false; } //exit some
			//Note, return false to continue and true to exit the .some() loop	
			return r;
		});
		console.log("pattern map result:",JSON.stringify(r));
		return this.createResult({matched:r});
	};
	
	this.pattern=function(patternStr, tokenObj){
		//adds a word pattern to the wordMatcher
		//[...] hello [punc] my name is [properNoun arg1][...]
		//split at: space spaces comma square-brackets
		//this.patterns.push(patternStr.split(/\s|,|\x5b|\x5d/gm));
		
		//grooming...
		//separate adjoining end & start brackets '][' to '] ['
		patternStr.replace(/\x5d\x5b/,"] [");
		//pad around periods
		patternStr.replace(/\./," . ");
		//what about ampersand&, comma, exclamation!, question mark?, quote"  
		//patterStr.replace(...);		
		//split at spaces
		this.patterns.push(patternStr.split(/\s+/gm));

	};
	
	//Pattern Storage
	//["["function(words){return true;}, "hello",...][...][...]]
	this.patterns=[];


	//this.report=function(){return JSON.stringify(this.result);};
	//this.result=resultDefault();
	
}


$(function() { 

	//console.log(window.dbAPI);
	
	var NOUNS="Andrew home book car cat".split(" ");
	
	var wm=new WordMatcher();
	//adds a pattern/token to the PM
	wm.pattern("[noun] is at [noun][verb] a [noun]", "pattern1"); //wm.createToken({val:1})   );
	
	//resolved definition I.e it is a function that returns true or false within 5 recursions
	wm.def("[noun]", function(w, ic){return(NOUNS.indexOf(w)!= -1);}); 
	//unresolved definition - right string has OR operators, words are endpoints since no definitions found 
	wm.def("[verb]", "read|reading|run|running");
	//resolved definition I.e reference made to a hash/dictionary eg. {... read:{meaning:"", sim:[]}...]}}
	//wm.define("[adverb]", "#ADVERB_DICTIONARY");
	
	//unresolved definition - right string has OR operators and words that are definitions 
	//wm.define("[phrase]", "[pronoun][noun]|[noun]")
	var r=wm.match("Andrew is at home, reading a magazine") // {match:true, score:0.1, response:1, msg:""}
	
	console.log(r);
	

	
}); //ready



</script>

</head>



<body>


<!-- TEMPLATES               -->
<template id='comments-template' type="text/x-handlebars-template">

	{{#each comments}}
	<div class='row row_'
			indexx={{@index}}
			onmouseenter='$(this).css("background-color","pink")'
			onmouseleave='$(this).css("background-color","white")'
			oncontextmenu='showMenu(CM$, event)'>
		<p id='itemNo'  indexx={{@index}} class='col-xs-1 itemNo'>{{#indexPlusOne @index}}{{/indexPlusOne}}</p>
		<p id='comment' indexx={{@index}} class='col-xs-10 comment-cell'>{{msg}}</p>
		<p id='picNo' indexx={{@index}} class='col-xs-1 picNo'>{{picRef}}</p>
	</div>
	{{/each}}
	
</template>

	
<!-- MENUS               -->
<div id='commentsMenu' onmouseleave='CM$.hide()' style='display:none'>
	<p onclick='commentsInsert(0, commentsData)'>Insert before</p>
	<p onclick='commentsInsert(1, commentsData)'>Insert after</p>
	<hr>
	<p onclick='console.log("Move up");$("#rowOptions").hide();'>Move up</p>
	<p onclick='console.log("Move dn");$("#rowOptions").hide();'>Move dn</p>
	<hr>
	<p onclick='commentsDelete(event);'>Delete</p>
	<hr>
	<p onclick='console.log("hide");'>Hide</p>
	<p onclick='console.log("show");'>Show hidden</p>
	<hr>
	<p onclick='testInsert();'>Test insert</p>
	<hr>
	<p onclick='CM$.hide()'>Exit</p>
</div>

<!-- PAGE STARTS HERE        -->

<div class='container'>
<nav class="navbar navbar-expand-lg navbar-light bg-light">
  <a class="navbar-brand" href="#">Navbar</a>
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  <div class="collapse navbar-collapse" id="navbarSupportedContent">
    <ul class="navbar-nav mr-auto">
      <li class="nav-item active">
        <a class="nav-link" href="#">Home <span class="sr-only">(current)</span></a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="#">Link</a>
      </li>
      <li class="nav-item">
        <a class="nav-link disabled" href="#">Disabled</a>
      </li>
    </ul>
    <form class="form-inline my-2 my-lg-0">
      <input class="form-control mr-sm-2" type="text" placeholder="Search" aria-label="Search">
      <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button>
    </form>
  </div>
</nav>
<br>

<!-- CARD -->
<div class="card" style="-width: 30rem;">
  <!--div class="card-header">header</div-->

  <div class="card-body">
	<h4 class="card-title">Card title</h4>
	<h6 class="card-subtitle mb-2 text-muted">Card subtitle</h6>
	<p class="card-text">Some quick example text to build on the card title and make up the bulk of the card's content.</p>
    <a href="#" class="card-link">Card link</a>
    <a href="#" class="card-link">Another link</a>
  </div>
  

	<ul class="list-group list-group-flush">
	<li class="list-group-item row-user">hello</li>
	<li class="list-group-item row-bot">hi</li>
	<li class="list-group-item row-user">what is the meaning of life?</li>
	<li class="list-group-item row-bot" >long or short answer?</li>
	</ul>

  
  <!--div class="card-footer">footer</div-->
</div>				
		
		
		
</div>

<!-- TURN DIALOG TEST  
<div class="line-container"> 
    <ul> 
       <li class="place-right right-msg-container"> 
       <span class="msg-box-right" data-timestamp=" 9:19 PM" data-readed="read">Hello</span> 
       </li> 
      <li class="place-right clear-fix right-msg-container"> 
        <span class="msg-box-right" data-timestamp=" 9:19 PM" data-readed="read">You are awesome</span> 
       </li> 
      <li class="place-left clear-fix left-msg-container"> 
       <span class="msg-box-left" data-timestamp="9:20 PM">Thanks:)</span> 
       </li> 
      <li class="place-left clear-fix left-msg-container"> 
         <span class="msg-box-left" data-timestamp="9:20 PM">You, too.</span> 
       </li> 
       <li class="place-left clear-fix left-msg-container"> 
         <span class="msg-box-left" data-timestamp="9:20 PM">Ism.</span> 
       </li> 
 
 
      <li class="place-right clear-fix right-msg-container"> 
         <span class="msg-box-right" data-timestamp="9:20  PM" data-readed="read">Espn test msg.</span> 
       </li> 
       <li class="place-left clear-fix left-msg-container"> 
         <span class="msg-box-left" data-timestamp="9:21 PM">Wonderful</span> 
       </li> 
     </ul> 
 
 
   </div> 

-->

</body>

</html>

